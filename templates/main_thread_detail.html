{% extends "base.html" %} {% load static %} {% load i18n %} {% block content %}
<h1>{{ main_thread.name }}</h1>

<div class="header-info">
  {% if main_thread.genres_visible %}
  <p>Genres: {{ main_thread.get_genres }}</p>
  {% endif %} {% if main_thread.platforms_visible %}
  <p>Platforms: {{ main_thread.get_platforms }}</p>
  {% endif %} {% if main_thread.involved_companies_visible %}
  <p>Involved Companies: {{ main_thread.get_involved_companies }}</p>
  {% endif %} {% if main_thread.game_engines_visible %}
  <p>Game Engines: {{ main_thread.get_game_engines }}</p>
  {% endif %} {% if main_thread.aggregated_rating_visible %}
  <p>Aggregated Rating: {{ main_thread.aggregated_rating }}</p>
  {% endif %}
</div>

<!-- Tabs -->
<div class="d-flex">
  <div
    class="flex-column nav nav-pills me-3"
    id="v-pills-tab"
    role="tablist"
    aria-orientation="vertical"
  >
    <button
      class="nav-link active"
      id="v-pills-about-tab"
      data-bs-toggle="pill"
      data-bs-target="#v-pills-about"
      type="button"
      role="tab"
      aria-controls="v-pills-about"
      aria-selected="true"
    >
      About
    </button>
    <button
      class="nav-link"
      id="v-pills-discussion-tab"
      data-bs-toggle="pill"
      data-bs-target="#v-pills-discussion"
      type="button"
      role="tab"
      aria-controls="v-pills-discussion"
      aria-selected="false"
    >
      Main Discussion
    </button>
  </div>

  <div class="tab-content" id="v-pills-tabContent">
    <div
      class="tab-pane fade show active"
      id="v-pills-about"
      role="tabpanel"
      aria-labelledby="v-pills-about-tab"
    >
      {% if main_thread.summary_visible %}
      <p>{{ main_thread.summary }}</p>
      {% endif %}
    </div>
    <div
      class="tab-pane fade"
      id="v-pills-discussion"
      role="tabpanel"
      aria-labelledby="v-pills-discussion-tab"
    >
      <!-- Main discussion content goes here -->
      <form method="post" action="{% url 'post_comment' main_thread.game_id %}">
        {% csrf_token %}
        <textarea name="text" required></textarea>
        <button type="submit">Post Comment</button>
      </form>

      <!-- Display existing comments -->
      {% for comment in main_thread.comments.all %}
      <div class="comment">
        <p>{{ comment.text }}</p>
        <p>
          Posted by {{ comment.user.username }} on {{ comment.created_date }}
        </p>

        <!-- Reply form -->
        <form method="post" action="{% url 'reply_to_comment' comment.id %}">
          {% csrf_token %}
          <textarea name="text" required></textarea>
          <button type="submit">Reply</button>
        </form>

        <!-- Upvote form -->
        <form method="post" action="{% url 'upvote_comment' comment.id %}">
          {% csrf_token %}
          <button type="submit">Upvote</button>
        </form>

        <!-- Downvote form -->
        <form method="post" action="{% url 'downvote_comment' comment.id %}">
          {% csrf_token %}
          <button type="submit">Downvote</button>
        </form>
      </div>
      {% endfor %}
    </div>
  </div>
</div>

{% endblock %}
